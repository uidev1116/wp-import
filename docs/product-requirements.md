# プロダクト要求定義書

## プロダクトビジョンと目的

### ビジョン
WordPressからa-blog cmsへの完全で包括的な移行を可能にする、高性能で信頼性の高いプラグインを提供する。

### 目的
WordPress標準のエクスポート機能（WXR形式）を利用して、既存のa-blog cms標準移行機能では対応できないメディアファイルの移行を含む、包括的な移行ソリューションを提供する。

### 背景・課題
- a-blog cms標準のWordPress移行機能は記事データ（エントリー）のみ対応
- WordPressのメディアライブラリをa-blog cmsのメディアデータに移行する機能が存在しない
- WordPress標準エクスポート（WXR形式）にはメディア情報は含まれるが、実ファイルは含まれない
- 手動でのメディア移行は大規模サイトでは非現実的

## ターゲットユーザーと課題・ニーズ

### プライマリーユーザー
- **Webサイト管理者**: WordPressからa-blog cmsへの移行を検討している企業・団体の担当者
- **Web制作会社**: クライアントのCMS移行案件を手掛ける制作会社のエンジニア・ディレクター
- **a-blog cms導入支援事業者**: a-blog cmsの導入・移行支援を行う専門事業者

### セカンダリーユーザー
- **サイト運営者**: WordPressで運営しているサイトのオーナー
- **システム管理者**: 企業内でCMSの管理・運用を担当する技術者

### ユーザーの課題
1. **手動移行の非効率性**: 大量のメディアファイルを手動で移行する作業コスト
2. **データ損失リスク**: 移行過程でのメディアファイル紛失や関連付けの破綻
3. **作業時間の長期化**: 移行作業に要する時間とリソースの負担
4. **技術的ハードル**: 移行作業に必要な技術知識の不足

### ユーザーのニーズ
1. **ワンストップ移行**: エントリーとメディアを一括で移行できる機能
2. **進捗の可視化**: 移行作業の進捗をリアルタイムで確認できる機能
3. **エラー対応**: 移行失敗時の詳細な情報と対処法の提供
4. **品質保証**: 移行後のデータ整合性を確認できる機能

## 主要な機能一覧

### コア機能
1. **WXRファイル解析機能**
   - WordPress Extended RSS（WXR）1.2形式の解析
   - エントリー情報とメディア情報の抽出
   - XML構造の検証とエラーハンドリング

2. **エントリー移行機能**
   - タイトル、本文、抜粋、メタデータの移行
   - カテゴリー・タグの移行とマッピング
   - カスタムフィールドの移行（可能な範囲で）
   - 公開状態・日時の保持

3. **メディア移行機能**
   - WordPressメディアファイルの自動ダウンロード
   - a-blog cmsメディアマネージャーへの登録
   - サムネイル画像の自動生成
   - メディア情報（ALTテキスト等）の保持

4. **URL書き換え機能**
   - エントリー本文内のWordPressメディアURL検出
   - a-blog cms新メディアURLへの自動置換
   - 画像タグ・リンクタグの更新

### 管理機能
5. **進捗管理機能**
   - リアルタイム進捗表示
   - バッチ処理による大量データ対応
   - 処理ログの記録と表示

6. **カテゴリーマッピング機能**
   - WordPressカテゴリーの自動作成
   - 手動マッピング設定
   - 階層構造の保持

7. **エラーハンドリング機能**
   - 詳細なエラーログ記録
   - 失敗時のスキップ・リトライ機能
   - 移行結果レポートの生成

### ユーティリティ機能
8. **セキュリティ機能**
   - ダウンロード対象URLの検証
   - ファイルタイプ・サイズ制限
   - ホワイトリスト方式のURL制限

9. **設定管理機能**
   - 移行設定の保存・再利用
   - バッチサイズ・タイムアウト設定
   - ログレベル設定

## 成功の定義

### 定量的指標
- **移行成功率**: 95%以上のエントリー・メディアの正常移行
- **処理性能**: 1000エントリー・1000メディアファイルを24時間以内に処理完了
- **エラー率**: 全体の5%以下に抑制
- **ユーザビリティ**: 管理画面操作の直感性（ユーザーテストでの成功率80%以上）

### 定性的指標
- **ユーザー満足度**: 移行作業の効率化を実感できること
- **データ品質**: 移行後のデータ整合性が保たれること
- **運用性**: トラブル時の原因特定と対処が容易であること
- **拡張性**: 将来的な機能追加・改修に対応可能な設計であること

## ビジネス要件

### 運用要件
- **可用性**: 移行処理中の中断・再開機能
- **スケーラビリティ**: 大規模サイト（10万エントリー以上）への対応
- **保守性**: ログ機能による問題の特定・解決支援

### セキュリティ要件
- **データ保護**: 移行過程でのデータ漏洩防止
- **アクセス制御**: 管理者権限での機能制限
- **脆弱性対策**: 外部ファイルダウンロード時のセキュリティ検証

### パフォーマンス要件
- **レスポンス性**: 管理画面操作の応答時間1秒以内
- **スループット**: 並行処理による高速化
- **リソース効率**: メモリ使用量の最適化

## ユーザーストーリー

### エピック1: WXR解析とアップロード
**AS A** Webサイト管理者
**I WANT TO** WordPressのWXRファイルを簡単にアップロードして解析したい
**SO THAT** 移行対象のデータ量と内容を事前に把握できる

#### ユーザーストーリー
1. **AS A** ユーザー **I WANT TO** WXRファイルをドラッグ&ドロップでアップロードしたい **SO THAT** 簡単に移行を開始できる
   - **前提条件**: WordPressからエクスポートする際は「全てのコンテンツ」を選択してWXRファイルを生成すること（投稿のみではなく、ページ・メディア・コメント等も含む包括的なエクスポート）
2. **AS A** ユーザー **I WANT TO** アップロード前にファイルサイズと内容をプレビューしたい **SO THAT** 移行の規模を把握できる
3. **AS A** ユーザー **I WANT TO** 不正なWXRファイルの場合は分かりやすいエラーメッセージを見たい **SO THAT** 問題を特定し修正できる

### エピック2: カテゴリー・タグ移行
**AS A** Webサイト管理者
**I WANT TO** WordPressのカテゴリー・タグをa-blog cmsの構造に合わせて移行したい
**SO THAT** サイトの情報構造を維持できる

#### ユーザーストーリー
1. **AS A** ユーザー **I WANT TO** WordPressカテゴリーをa-blog cmsカテゴリーにマッピングしたい **SO THAT** 適切な分類で移行できる

### エピック3: メディア移行
**AS A** Webサイト管理者
**I WANT TO** WordPressのメディアファイルを自動でa-blog cmsに移行したい
**SO THAT** 手動コピーの手間を省き、リンク切れを防げる

#### ユーザーストーリー
1. **AS A** ユーザー **I WANT TO** WordPressサイトからメディアファイルを自動ダウンロードしたい **SO THAT** 手動でのファイル収集が不要になる
2. **AS A** ユーザー **I WANT TO** エントリー本文内の画像URLが自動で書き換わってほしい **SO THAT** 移行後もリンク切れが起きない
3. **AS A** ユーザー **I WANT TO** ダウンロード失敗したメディアを特定したい **SO THAT** 手動で対応すべき箇所を把握できる

### エピック4: 進捗管理とレポート
**AS A** Webサイト管理者
**I WANT TO** 移行処理の進捗をリアルタイムで確認したい
**SO THAT** 処理状況を把握し、必要に応じて対処できる

#### ユーザーストーリー
1. **AS A** ユーザー **I WANT TO** 移行処理の進捗をパーセンテージで確認したい **SO THAT** 完了までの時間を予測できる
2. **AS A** ユーザー **I WANT TO** 処理中に発生したエラーをリアルタイムで確認したい **SO THAT** 問題の早期発見ができる
3. **AS A** ユーザー **I WANT TO** 移行完了後に詳細レポートを確認したい **SO THAT** 移行結果の品質を評価できる

## 受け入れ条件

### WXRファイル解析機能
- [ ] 有効なWXRファイルを正常に解析できること
- [ ] 不正なXMLファイルに対して適切なエラーメッセージを表示すること
- [ ] ファイルサイズ制限を超えた場合に警告を表示すること
- [ ] エントリー数とメディア数を正確にカウントできること

### エントリー移行機能
- [ ] タイトル、本文、抜粋が正確に移行されること
- [ ] 公開日時、更新日時が保持されること
- [ ] カテゴリー・タグが正しく関連付けられること
- [ ] カスタムフィールドが可能な範囲で移行されること

### メディア移行機能
- [ ] WordPressメディアURLからファイルを正常にダウンロードできること
- [ ] a-blog cmsメディアマネージャーに正しく登録されること
- [ ] エントリー本文内のメディアURLが正確に書き換わること
- [ ] ダウンロード失敗時に適切なログが記録されること

### 進捗管理機能
- [ ] 処理進捗が1秒以内に更新されること
- [ ] バッチ処理が中断・再開できること
- [ ] エラー発生時に処理を継続できること
- [ ] 完了後に詳細レポートが表示されること

### パフォーマンス要件
- [ ] 1000エントリーの移行を24時間以内に完了できること
- [ ] メモリ使用量が512MB以下に収まること
- [ ] 管理画面の応答時間が1秒以内であること

### セキュリティ要件
- [ ] 管理者権限でのみアクセスできること
- [ ] ダウンロード対象URLが制限されていること
- [ ] アップロードファイルの検証が行われること

## 機能要件

### 必須機能（Must Have）
1. WXRファイルの解析とエントリー情報抽出
2. エントリーのa-blog cmsへの移行
3. メディアファイルのダウンロードと登録
4. エントリー本文内URL書き換え
5. 基本的な進捗表示
6. エラーログ記録

### 重要機能（Should Have）
1. カテゴリー・タグのマッピング設定
2. バッチ処理による大量データ対応
3. リアルタイム進捗表示
4. 詳細な移行レポート
5. 設定の保存・再利用機能

### 対象外機能（Won't Have）
1. WordPress以外のCMSからの移行
2. リアルタイム同期機能
3. 双方向移行機能
4. WordPressプラグインデータの移行

## 非機能要件

### パフォーマンス
- **応答時間**: 管理画面操作で1秒以内
- **スループット**: 1000エントリー/24時間以内
- **メモリ使用量**: 最大512MB

### 可用性
- **稼働率**: 99%以上（移行処理中）
- **復旧時間**: エラー発生から1時間以内の対処可能

### 拡張性
- **データ量**: 最大10万エントリーまで対応
- **同時接続**: 管理画面で10ユーザーまで

### 保守性
- **ログ保持**: 30日間のログ保存
- **監視**: エラー率・処理時間の監視機能

### セキュリティ
- **認証**: a-blog cms管理者権限での制御
- **データ保護**: 移行データの暗号化（必要に応じて）
- **アクセス制御**: IPアドレス制限（設定可能）
